<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
    <title>Task Tracker - Turing Tooling</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        h1, h2 {
            color: #667eea !important;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: black;
            min-height: 100vh;
            color: white;
        }

        .dashboard-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .task-tracker-section {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .tracker-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .tracker-header h1 {
            font-size: 3rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tracker-description {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
        }

        .filters-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            position: relative;
        }

        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .filters-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #667eea;
        }

        .reload-button {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            font-size: 0.9rem;
            font-weight: 600;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .reload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        .reload-button:active {
            transform: translateY(0);
        }

        .reload-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .filter-select, .filter-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            color: white;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .filter-select option {
            background: #2a2a2a;
            color: white;
        }

        .analytics-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .analytics-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .analytics-card:hover {
            transform: translateY(-5px);
        }

        .analytics-number {
            font-size: 3rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .analytics-label {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 1rem;
        }

        .analytics-description {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.4;
        }

        .tasks-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            min-height: 400px;
        }

        .tasks-header {
            font-size: 1.3rem;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #4CAF50;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .task-tracker-section {
                padding: 0 1rem;
            }

            .tracker-header h1 {
                font-size: 2.2rem;
            }

            .tracker-description {
                font-size: 1rem;
            }

            .filters-container {
                padding: 1.5rem;
            }

            .filters-header {
                flex-direction: column;
                gap: 1rem;
                // align-items: flex-start;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .analytics-container {
                grid-template-columns: 1fr;
            }

            .analytics-number {
                font-size: 2rem;
            }
        }
    </style>
    <script>
        var github_username_mapping = new Object();
        ////////// AUTOMATED TRACKER CONSTANTS ////////////
        const CREATED_DATE = 0;
        const WEEK_NUM = 1;
        const TASK = 2;
        const GITHUB_USERNAME_AT = 3; // meaning that it is the one in the automated tracker sheet
        const LEAD = 4;
        const CALIBRATOR = 5;
        const DOMAIN = 6;
        const DB_USED = 7;
        const INTERFACE = 8;
        const APIs_USED = 9;
        const COMPLEXITY = 10;
        const PR_STATUS = 11;
        const CALIBRATED_BY = 12;
        const MERGED_DATE = 13;
        const CALIBRATION_METHOD = 14;
        const UPDATED_DATE = 15;
        ////////// AUTOMATED TRACKER CONSTANTS ////////////

        ////////// TEAM STRUCTURE CONSTANTS ////////////
        var pods = new Set();
        var calibrators = new Set();
        var trainers = new Set();


        // Function to reload tracker data
        function reloadTrackerData() {
            const reloadBtn = document.getElementById('reloadBtn');
            const originalText = reloadBtn.innerHTML;
            const spinner = '<span class="loading-spinner"></span>';
            
            reloadBtn.innerHTML = spinner + ' Reloading...';
            reloadBtn.disabled = true;

            // Simulate API call to reload tracker data
            fetch('/tracker', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('Tracker data reloaded:', data);
                reloadBtn.innerHTML = 'Reloaded &#10003;';
                
                username_email_mapping = data.username_email_mapping || {};
                // console.log('Username to Email Mapping:', username_email_mapping);
                /* for (const [username, actual_name, email] of Object.entries(username_email_mapping)) {
                    if (email) {
                        github_username_name_mapping[username] = actual_name;
                    }
                } */
                for (const user of username_email_mapping) {
                    if (user['GitHub Username']) {
                        github_username_mapping[user['GitHub Username']] = user['Email'];
                    }
                }
                console.log('GitHub Username to Name Mapping:', github_username_mapping);
                
                for (const team_structure of data.team_structure) {
                    pods.add(team_structure['Pod Lead']);
                    // calibrators.add(team_structure.calibrator);
                    // trainers.add(team_structure.trainer);
                }

                console.log('Pods:', pods);
                
                
                // Update analytics if data is provided
                if (data.analytics) {
                    updateAnalytics(data.analytics);
                }
                
                setTimeout(() => {
                    reloadBtn.innerHTML = originalText;
                    reloadBtn.disabled = false;
                }, 2000);
            })
            .catch(error => {
                console.error('Error reloading tracker data:', error);
                reloadBtn.innerHTML = '❌ Error';
                setTimeout(() => {
                    reloadBtn.innerHTML = originalText;
                    reloadBtn.disabled = false;
                }, 2000);
            });
        }

        // Function to update analytics display
        function updateAnalytics(analytics) {
            if (analytics.totalTasks) {
                document.getElementById('totalTasks').textContent = analytics.totalTasks;
            }
            if (analytics.activePods) {
                document.getElementById('activePods').textContent = analytics.activePods;
            }
            if (analytics.completionRate) {
                document.getElementById('completionRate').textContent = analytics.completionRate + '%';
            }
        }

        // Function to apply filters
        function applyFilters() {
            const filters = {
                week: document.getElementById('weekFilter').value,
                pod: document.getElementById('podFilter').value,
                trainer: document.getElementById('trainerFilter').value,
                dateRange: document.getElementById('dateRange').value
            };

            console.log('Applying filters:', filters);
            
            // Here you would typically make an API call to filter the data
            // fetch('/api/tasks/filter', { method: 'POST', body: JSON.stringify(filters) })
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners to filters
            document.querySelectorAll('.filter-select, .filter-input').forEach(element => {
                element.addEventListener('change', applyFilters);
            });

            // Load initial data
            // reloadTrackerData();
        });
    </script>
</head>
<body>
    <header class="dashboard-header">
        <div class="logo">
            <img src="{{ url_for('static', filename='images/turing_logo.svg') }}" alt="turing image" style="width: 100px; scale: 1.5; display: block; margin: 0 auto;">
        </div>
    </header>

    <!-- Task Tracker Section -->
    <section class="task-tracker-section">
        <div class="tracker-header">
            <h1>Task Tracker</h1>
            <p class="tracker-description">
                Comprehensive task analysis and monitoring system that provides real-time insights into task distribution, 
                completion rates, and performance metrics across all pods. Track the number of active tasks, monitor 
                workload distribution, and analyze productivity patterns to optimize Amazon agentic project workflow.
            </p>
        </div>

        <!-- Analytics Overview -->
        <div class="analytics-container">
            <div class="analytics-card">
                <div class="analytics-number" id="totalTasks">?</div>
                <div class="analytics-label">Total Tasks</div>
                <div class="analytics-description">Active and completed tasks across all pods</div>
            </div>
            <div class="analytics-card">
                <div class="analytics-number" id="activePods">?</div>
                <div class="analytics-label">Active Pods</div>
                <div class="analytics-description">Currently operational pod instances</div>
            </div>
            <div class="analytics-card">
                <div class="analytics-number" id="completionRate">?%</div>
                <div class="analytics-label">Completion Rate</div>
                <div class="analytics-description">Overall task completion percentage</div>
            </div>
        </div>

        <!-- Filters Container -->
        <div class="filters-container">
            <div class="filters-header">
                <h2 class="filters-title">Filters & Controls</h2>
                <button id="reloadBtn" class="reload-button" onclick="reloadTrackerData()">
                    &#x21bb Reload Data
                </button>
            </div>
            
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label" for="weekFilter">Week</label>
                    <select id="weekFilter" class="filter-select">
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label" for="podFilter">Pod</label>
                    <select id="podFilter" class="filter-select">
                    </select>
                </div>
                
                
                <div class="filter-group">
                    <label class="filter-label" for="trainerFilter">Trainer</label>
                    <select id="trainerFilter" class="filter-select">
                        <option value="all">All Trainers</option>
                        <option value="trainer1">Trainer 1</option>
                        <option value="trainer2">Trainer 2</option>
                        <option value="trainer3">Trainer 3</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label" for="dateRange">Date Range</label>
                    <input type="date" id="dateRange" class="filter-input">
                </div>
            </div>
        </div>

        <!-- Tasks Display Container -->
        <div class="tasks-container">
            <div class="tasks-header">
                <span>Task Distribution</span>
                <span style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.6);">Real-time task monitoring</span>
            </div>
            
            <!-- This is where your task data would be displayed -->
            <div id="tasksDisplay" style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 2rem;">
                Loading task data...
            </div>
        </div>
    </section>

    <script>
        var filters = null;
        window.addEventListener('DOMContentLoaded', function() {
            // Simulate loading task data
            
        });
    </script>
</body>
</html>